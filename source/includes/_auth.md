<h1 id="auth">احراز هویت</h1>

<h2 id="auth-intro">روش پیشنهادی دریافت توکن</h2>

روش پیشنهادی نوبیتکس برای دریافت توکن استفاده از API، دریافت آن از پنل کاربری است. برای دریافت توکن می‌توانید با مراجعه به پنل کاربری خود در نوبیتکس، از بخش پروفایل وارد صفحه تنظیمات شده و توکن خود را دریافت نمایید. در صورتی که گزینه «مرا به خاطر بسپار» را در هنگام ورود به نوبیتکس انتخاب کرده باشید، این توکن تا ۳۰ روز یا زمان لاگ‌اوت شما از نوبیتکس معتبر خواهد ماند.

در ادامه روش دریافت خودکار توکن با استفاده از کد توضیح داده می‌شود. معمولاً دریافت خودکار توکن ضروری نیست و روش پیشنهادی ما برای اغلب کاربران دریافت مستقیم توکن از پنل کاربری است. تنها در صورتی که با مخاطرات ذخیره گذرواژه خود در کد و روش‌های امن این کار آشنا هستید، در استفاده از API مهارت دارید، و از طرفی نیاز به دریافت کاملاً خودکار توکن دارید، از API دریافت توکن استفاده نمایید.

همین طور پیشنهاد می‌شود که گام‌های اولیه توسعه کد خود را با دریافت توکن از پنل انجام دهید تا با فرآیند استفاده از API نوبیتکس بیشتر آشنا شوید و تنها در صورت نیاز و در گام نهایی‌سازی کد خود اقدام به خودکارسازی دریافت توکن نمایید. لازم به توضیح است که به دلیل مسائل امنیتی مانند شناسایی دوعاملی و کپچا و ... برای دریافت خودکار توکن باید به دقت مستندات این بخش را مطالعه نمایید.

<h2 id="login">ورود - دریافت توکن</h2>
> برای دریافت توکن، از این کد استفاده کنید:

```shell
curl 'https://apiv2.nobitex.ir/auth/login/' \
  -X POST \
  --header "Content-Type: application/json" \
  --header "X-TOTP: <Your TOTP value>" \
  --header "User-Agent: TraderBot/<Your bot version and name>" \
  --data $'{"username":"name@example.com","password":"secret-password-1234","captcha":"api"}'
```

```plaintext
http POST https://apiv2.nobitex.ir/auth/login/ \
  username=name@example.com password=secret-password-1234 captcha=api
```

> در صورت فراخوانی درست، پاسخ به این صورت خواهد بود:

```json
{
    "status": "success",
    "key": "db2055f743c1ac8c30d23278a496283b1e2dd46f",
    "device": "AlRyansW"
}
```

دریافت توکن به صورت خودکار و با ارسال درخواست به `/auth/login/` صورت می‌گیرد. این تنها APIی است که نیاز دارید
به آن نام کاربری و رمز عبور خود را ارسال کنید. تمامی دیگر APIها از توکن به جای رمز عبور برای احراز هویت استفاده می‌کنند.
توکن‌های صادر شده بعد از چهار ساعت منقضی می‌شوند و باید مجددا با ارسال درخواست لاگین، توکن جدیدی دریافت کنید.
در صورتی که نیاز به ایجاد توکن‌های بلند مدت دارید، از پارامتر `remember=yes` استفاده کنید تا توکن ایجاد شده به مدت سی
روز معتبر بماند.
توجه داشته باشید، در صورتی که قصد استفاده از وب سرویس  بدون ورود کپچای تصویری را دارید، نیاز است مقدار captcha حتما برابر api تنظیم شود و کد دوعاملی بر روی حساب کاربری تنظیم گردد و مقدار لحظه ای آن در هدر ریکویست ارسال شود. همینطور  مقدار هدر User-Agent را مطابق الگوی TraderBot/XXXXX ارسال نمایید، که بخش XXXXX هر نام یکتایی است که می‌توانید برای بات خود انتخاب کنید. جهت تنظیم کد دوعاملی، توضیحات دقیق‌تر را <a href="#dbf936619c">از اینجا</a> مطالعه فرمایید.


* **درخواست:** `/POST /auth/login `
* **<a href="/#ratelimit">محدودیت فراخوانی:</a>** ۳۰ درخواست در هر ۱۰ دقیقه


### پارامترهای ورودی

پارامتر | نوع | پیش‌فرض | توضیحات | نمونه
------- | ---- | --------- | --------- | -----
username | string | الزامی | ایمیل کاربر | `name@example.com`
password | string | الزامی | گذرواژه کاربر | `secret-password-1234`
remember | string | no | آیا توکن بلند مدت صادر شود؟ | `yes` یا `no`
captcha | string | الزامی | کپچا | `api`


### پارامترهای هدر

پارامتر | نوع | پیش‌فرض | توضیحات              | نمونه
------- | ---- | --------- |----------------------| -----
X-TOTP | string | الزامی | کد دوعاملی           | `123456`
User-Agent | string | الزامی | ایجنت                | `TraderBot/1.0.0`

### نکات و ملاحظات

1. دقت نمایید که انتهای آدرس url ارسال درخواست، حتماً باید `/` گذاشته شود.
2. توکن‌های دریافت شده از این روش، بعد از اتمام زمان اعتبار یا انجام عملیات لاگ‌اوت منقضی می‌شوند. زمان پیش‌فرض اعتبار توکن چهار ساعت است که می‌توانید با استفاده از پارامتر `remember` توکن‌هایی با زمان اعتبار یک ماه دریافت نمایید.
3. برای لاگین و دریافت توکن، حتماً باید از آی‌پی ایران درخواست ارسال شود. در غیر این صورت، خطای 429 برگردانده می‌شود. بدیهی است که استفاده از هر VPN یا VPS خارجی، منجر به این خطا خواهد شد. در حالت استفاده از آی‌پی ایران می‌توانید مقدار کپچا را در درخواست برابر `api` مقداردهی کنید.
4. در صورت مشکل در دریافت توکن، می‌توانید مطابق [روش پیشنهادی](#auth-intro) دریافت توکن از توکن‌‌های موجود در تنظیمات پروفایل خود استفاده کنید.


<h2 id="login-faq">سوالات متداول دریافت توکن</h2>

### آیا نوبیتکس توکن بلند مدت هم ارائه می‌دهد؟
در نوبیتکس می‌توانید توکن‌هایی با تاریخ انقضای حداکثر یک ماه دریافت نمایید. در صورتی که گزینه «مرا به خاطر بسپار» را در زمان لاگین به سایت نوبیتکس انتخاب نمایید، توکنی که در بخش پروفایل دریافت می‌کنید برای مدت یک ماه معتبر خواهد بود. در صورتی که از API دریافت توکن استفاده می‌کنید، می‌توانید از پارامتر `remember` استفاده کنید. مد نظر داشته باشید که در صورت انجام عملیات لاگ‌اوت از حساب خود در سایت یا API توکن شما دیگر معتبر نخواهد ماند.

### من با استفاده از گوگل در نوبیتکس ثبت نام کرده‌ام. چگونه می‌توانم با API کار کنم؟
[روش پیشنهادی](#auth-intro) دریافت توکن، دریافت آن از پنل کاربری است و با این روش تمام کاربران مستقل از روش ورود به نوبیتکس می‌توانند توکن خود را مشاهده و دریافت نمایند. کاربرانی که با استفاده از حساب گوگل در نوبیتکس ثبت‌نام کرده باشند و بخواهند از روش خودکار دریافت توکن استفاده کنند، می‌توانند از امکان فراموشی رمز عبور استفاده کرده و رمز جدید برای حساب خود تعیین و پس از آن اقدام به استفاده از API نمایند.

### در هنگام لاگین با خطای MissingCaptcha روبرو شده‌ام. مشکل چیست؟
مطابق [روش پیشنهادی](#auth-intro) دریافت توکن، برای دریافت توکن به پنل کاربری خود در سایت، بخش «پروفایل: تنظیمات» مراجعه نمایید. اگر از روش خودکار دریافت توکن استفاده می‌کنید، مستندات مربوطه را با دقت مطالعه نمایید.

### در هنگام لاگین با خطای MissingOTP روبرو شده ام. چگونه این مشکل حل میشود؟
هنگامی که شناسایی دوعاملی حساب شما فعال باشد، در هنگام استفاده از API نیز می‌بایست این حالت حفظ شده و رمز یکبار مصرف ارسال گردد. این کار از طریق ارسال این رمز با استفاده از پارامتر X-TOTP امکان‌پذیر خواهد بود. تولید کد دوعاملی با استفاده از فرمول استانداردی در کد ممکن است.


<h2 id="logout">خروج - سوزاندن توکن</h2>
> برای خروج یا سوزاندن توکن، از این کد استفاده کنید:

```shell
curl -X POST 'https://apiv2.nobitex.ir/auth/logout/' \
--header 'Authorization: Token yourTOKENhereHEX0000000000'
```

```plaintext
POST /auth/logout/ HTTP/1.1
Host: apiv2.nobitex.ir
Authorization: Token yourTOKENhereHEX0000000000
```

> در صورت فراخوانی درست، پاسخ به این صورت خواهد بود:

```json
{
    "detail": "خروج با موفقیت انجام شد.",
    "message": "خروج با موفقیت انجام شد."
}
```

- **درخواست:** `/POST /auth/logout `
