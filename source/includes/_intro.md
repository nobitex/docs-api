# مستندات API نوبیتکس

```
NOBITEX
```

به مستندات API [نوبیتکس](https://nobitex.ir)، بزرگترین بازار ارز دیجیتال ایران خوش آمدید. نوبیتکس از ابتدای کار API خود را در اختیار تمامی کاربران و توسعه‌دهندگان گرامی قرار داده است. با استفاده از API نوبیتکس می‌توانید علاوه بر اطلاع از آخرین قیمت‌ها و وضعیت بازار رمزارزها در ایران، اقدام به مدیریت حساب نوبیتکس خود به روش خودکار و مبتنی بر کد نمایید. استفاده از API علاوه بر فراهم‌سازی امکانات نوین برای کاربران، امکان انجام معاملات خودکار که باعث سیال و منصفانه‌تر شدن قیمت در بازارها می‌شود را فراهم می‌کند.

پیش از استفاده از API نوبیتکس اطمینان حاصل کنید که با
[قوانین نوبیتکس](https://nobitex.ir/policies/terms/)
و همچنین
[قوانین و شرایط استفاده از API نوبیتکس](/terms/)
آشنایی کامل دارید.
همین طور با توجه به احتمال ایجاد تغییرات در بستر نوبیتکس یا ساختار و جزئیات APIها، همواره به اطلاعیه‌های
[کانال رسمی تلگرام نوبیتکس](https://t.me/nobitexmarket)
و [کانال رسمی تلگرام API نوبیتکس](https://t.me/NobitexAPINews)
دقت کنید. به علاوه به صورت مستمر
[صفحه سابقه تغییرات API نوبیتکس](/changelog/)
را رصد کنید تا از تمامی تغییرات API نوبیتکس مطلع باشید.

در استفاده از API همواره اطمینان حاصل کنید که کد شما قابلیت مواجهه با حالت‌های خطا و شرایط و تغییرات پیش‌بینی نشده را داشته باشد و عکس العمل مناسبی در این خصوص نشان دهد. با توجه به حساسیت‌های بازارهای مالی، لازم است که کدهای استفاده کننده از API به صورت اصولی و با ملاحظاتی مانند کنترل نرخ درخواست‌ها در شرایط مختلف، مدیریت حالت‌های خطا، پیش‌گیری از تشدید آبشاری خطاها، سازوکارهای حفاظت در عمق، وجود سامانه‌های مانیتورینگ و اعلان، وجود سازوکارهای مدیریت ریسک و ... توسعه داده شود.

اگر برای اولین بار است که از API نوبیتکس استفاده می‌کنید، می‌توانید از بخش
<a href="#quickstart">راهنمای شروع به کار با API</a>
کمک بگیرید.

<h2 id="intro-auth">احراز هویت و توکن</h2>
```
Authorization: Token yourTOKENhereHEX0000000000
```

برای استفاده از APIهای غیر عمومی نیاز به ارسال توکن وجود دارد. این توکن باید به عنوان HTTP Header درخواست به صورت زیر ارسال شود:

`Authorization: Token yourTOKENhereHEX0000000000`

به جز APIهای بخش‌هایی که عنوان «عمومی» در انتهای نام‌شان آورده شده باشد، برای استفاده از تمام APIها نیاز به ارسال توکن وجود دارد. توکن مشخص می‌کند که کدام کاربر در حال ارسال این درخواست است.

<aside class="warning">
  <b>به هیچ عنوان توکن خود را در اختیار دیگران قرار ندهید.</b>
  <br/>
  اگر این توکن به صورت تصادفی در اختیار دیگران قرار گرفت سریعاً logout کرده و اقدام به لاگین و دریافت توکن جدید کنید.
</aside>

برای دریافت توکن می‌توانید با مراجعه به پنل کاربری خود در نوبیتکس، از بخش پروفایل وارد
<a href="https://nobitex.ir/app/settings/" target="_blank">صفحه تنظیمات</a>
شده و توکن خود را دریافت نمایید. در صورتی که گزینه «مرا به خاطر بسپار» را در هنگام ورود به نوبیتکس انتخاب کرده باشید، این توکن تا ۳۰ روز یا زمان لاگ‌اوت شما از نوبیتکس معتبر خواهد ماند.

در صورت تمایل به دریافت دوره‌ای و خودکار توکن، می‌توانید از
<a href="#login">API ورود - دریافت توکن</a>
استفاده نمایید. ولی این کار ضروری نیست و روش پیشنهادی ما برای اغلب کاربران دریافت مستقیم توکن از پنل کاربری است. تنها در صورتی که با مخاطرات ذخیره گذرواژه خود در کد و روش‌های امن این کار آشنا هستید، در استفاده از API مهارت دارید، و از طرفی نیاز به دریافت کاملاً خودکار توکن دارید، از API دریافت توکن استفاده نمایید.

<h2 id="apikey"> کلید ای‌پی‌آی (آزمایشی)</h2>

کلید ای پی آی برای دسترسی امن تر و با مجوز مشخص به ای پی آی‌های نوبیتکس طراحی
شده است. 
کلید ای پی آی به شما اجازه می‌دهد به صورت کنترل شده و از روی آی پی مشخص،
به ای پی آی های نوبیتکس دسترسی داشته باشید و مدت زمان اعتبار کلید را مشخص کنید.

<h3 id="apikey-usecases">اهداف و کاربردها</h3>
<h4>چرا API Key؟</h4>
- امنیت بیشتر (امکان تعریف سطح دسترسی محدود) با سه دسترسی READ, WITHDRAW, TRADE
- پشتیبانی از **IP Whitelist**
- قابلیت تنظیم تاریخ انقضای دلخواه
- قابلیت غیرفعال‌سازی یا حذف بدون تغییر پسورد اصلی
- مناسب برای ربات‌ها و اسکریپت‌های خودکار

<h4>سطوح دسترسی (Permissions)</h4>
- **READ** →دریافت اطلاعات بدون تغییر در دیتابیس   
- **TRADE** → عملیات‌های مربوط به معامله و ترید، که منجر به تغییری در دیتابیس می‌شوند.  
- **WITHDRAW** → دسترسی عملیات برداشت 

توجه کنید که برای دسترسی به ای پی آی هایی مانند لیست سفارشات، دسترسی READ الزامی است.
هر کلید می‌تواند یکی یا چند دسترسی داشته باشد.


<h3>ایجاد API Key</h3>

<h4>آدرس</h4>

POST /apikeys/create

<h4>پارامترهای ورودی</h4>

| پارامتر                | نوع            | پیش‌فرض     | توضیحات                                                                 | نمونه                                       |
|------------------------|----------------|-------------|--------------------------------------------------------------------------|---------------------------------------------|
| `name`                 | string         | الزامی      | نام کلید برای شناسایی توسط کاربر                                         | `"my-api-key"`                              |
| `description`          | string         | خالی (`''`) | توضیحات دلخواه کاربر                                                     | `"API key for internal services"`           |
| `permissions`          | string (enum)  | الزامی      | مقادیر مجاز: `READ`, `TRADE`, `WITHDRAW` (به صورت رشته و جداشده با کاما) | `"READ,TRADE"`                              |
| `ipAddressesWhitelist` | list           | `[]`        | لیست آدرس‌های IP مجاز (IPv4/IPv6)                                        | `["192.168.1.10", "10.0.0.5"]`              |
| `expirationDate`       | datetime (UTC) | `None`      | تاریخ انقضای کلید (اختیاری)                                             | `"2025-12-31T23:59:59Z"`                    |


<h4>نکات امنیتی</h4>
- ارسال **OTP (2FA)** در هدر `X-totp` الزامی است.  
- بعد از ایجاد کلید، یک **ایمیل اطلاع‌رسانی** برای کاربر ارسال می‌شود.  
- رویداد ایجاد کلید در لاگ ثبت می‌شود.  

> نمونه درخواست

```json
{
  "name": "my-api-key",
  "description": "API key for internal services",
  "permissions": "READ,TRADE",
  "ipAddressesWhitelist": [
    "192.168.1.10",
    "10.0.0.5"
  ],
  "expirationDate": "2025-12-31T23:59:59Z"
}
```

> نمونه پاسخ

```json 
{
  "key": {
    "createdAt": "2025-09-02T16:50:29.381869Z",
    "description": "API key for internal services",
    "expirationDate": "2025-12-31T23:59:59Z",
    "ipAddressesWhitelist": ["192.168.1.10", "10.0.0.5"],
    "key": "5XOCQZSPLQM4MiLzuUnZoBuqgYgTKl40W2X5j1pxfIA=",
    "name": "my-api-key",
    "permissions": "READ,TRADE",
    "updatedAt": "2025-09-02T16:50:29.381876Z"
  },
  "privateKey": "S5y19KewZzheCWCO4xqMcwwvtR8vQ-hHjE_cdjz-XxE=",
  "status": "ok"
}
```
⚠️ توجه: کلید خصوصی (privateKey) فقط یک بار در پاسخ نمایش داده می‌شود. حتماً آن را در مکان امن (Secret Manager) ذخیره کنید.

<h3>مدیریت کلیدها</h3>

<h4>لیست کلیدها</h4>

GET /apikeys/list

خروجی: لیست کلیدهای کاربر + وضعیت و اطلاعات آنها.

<h4>حذف کلید</h4>

POST /apikeys/delete/<public_key>

ورودی: public_key در آدرس 
خروجی:
```json
 {
  "status": "ok"
 }
```

کلید عمومی را در یو آر ال قرار دهید. 

#### بروزرسانی کلید

POST /apikeys/update/<public_key>

قابل تغییر: name, description, ipAddressesWhitelist
خروجی: شیء کلید به‌روزرسانی‌شده.

> نمونه درخواست

```json
{
  "name": "my-api-key",
  "description": "API key for internal services",
  "ipAddressesWhitelist": [
    "192.168.1.10",
    "10.0.0.5"
  ]
}
```

> نمونه پاسخ

```json 
{
  "key": {
    "createdAt": "2025-09-02T16:50:29.381869Z",
    "description": "API key for internal services",
    "expirationDate": "2025-12-31T23:59:59Z",
    "ipAddressesWhitelist": ["192.168.1.10", "10.0.0.5"],
    "key": "5XOCQZSPLQM4MiLzuUnZoBuqgYgTKl40W2X5j1pxfIA=",
    "name": "my-api-key",
    "permissions": "READ,TRADE",
    "updatedAt": "2025-09-02T16:50:29.381876Z"
  },
  "status": "ok"
}
```

<h3>دسترسی ها</h3>

سه دسترسی خواندن، معامله و برداشت تعریف شده است.

<h4>READ</h4>

دسترسی خواندن مخصوص تمام ای پی آی هایی است که تغییری در دیتابیس ایجاد نمی‌کنند.
با ایجاد این دسترسی روی یک کلید، دسترسی به ای پی آی های زیر، ایجاد می‌شود.:

**اطلاعات کاربر**

* `users/preferences`
* `users/profile`
* `users/verification/status`
* `notifications/list`
* `users/limitations`

**مارکت**

* `market/orders/status`
* `market/orders/list`
* `market/trades/list`

**پورتفولیو**

* `users/portfolio/last-week-daily-profit`
* `users/portfolio/last-week-daily-total-profit`
* `users/portfolio/last-month-total-profit`
* `users/portfolio/daily_total_balance`

**واریز شتابی**

* `users/payments/ids-list`

**کیف پول**

* `users/wallets/list`
* `v2/wallets`
* `users/wallets/balance`
* `users/wallets/transactions/list`
* `users/transactions-history`
* `users/wallets/deposits/list`
* `users/wallets/withdraws/list`
* `users/wallets/deposit/bank`
* `users/wallets/deposit/shetab`
* `withdraws/<withdraw_id>`

**معاملات تعهدی**

* `margin/fee-rates`
* `margin/delegation-limit`
* `margin/v2/delegation-limit`
* `positions/list`
* `positions/active-count`
* `positions/<position_id>/status`
* `positions/<position_id>/edit-collateral/options`
* `margin/predict/<category>`


<h3>Trade</h3>
کلید با این دسترسی، به ای پی آی هایی که برای ثبت و کنسل سفارشات و در کل کنترل
سفارشات استفاده می‌شوند، دسترسی دارد. 

با اختصاص این مجوز به یک کلید، دسترسی به ای پی آی های زیر به آن کلید داده می‌شود:

**معاملات تعهدی**

* `margin/orders/add`
* `positions/<int:pk>/close`
* `positions/<int:pk>/edit-collateral`

**معاملات بازار اسپات**

* `market/orders/add`
* `market/orders/batch-add`
* `market/orders/update-status`
* `market/orders/cancel-old`
* `market/orders/cancel-batch`
* `users/wallets/convert`

<h3 id="Withdraw-apikey">Withdraw</h3>

کلید با این دسترسی، به ای پی آی های برداشت دسترسی دارد. 
پیشنهاد می‌کنیم برای این کلید حتما آی پی مشخص کنید.
با اختصاص این مجوز به یک کلید، دسترسی به این اند پوینت ها باز می‌شود:

* `withdraws/<withdraw_id>/update-status`
* `users/wallets/withdraw`
* `users/wallets/withdraw-confirm`
* `users/wallets/withdraw-cancel`
* 

<h3 id="use-apikey">استفاده از کلید API</h3>

برای استفاده از API باید سه هدر زیر در هر درخواست ارسال شوند:

| Header                | توضیح                                                                 |
|------------------------|----------------------------------------------------------------------|
| `Nobitex-Key`          | کلید عمومی تولید شده توسط کاربر                                      |
| `Nobitex-Signature`    | امضای محاسبه‌شده با الگوریتم `Ed25519`                              |
| `Nobitex-Timestamp`    | زمان جاری به ثانیه (Unix timestamp) در منطقه زمانی UTC               |

<h4>نحوه محاسبه امضا (Signature)</h4>

امضا به صورت زیر محاسبه می‌شود:

```shell
   signature = base64(Ed25519(timestamp + method + url + body))
```

- **timestamp**: عدد ثانیه‌ای (Unix time) بر اساس UTC  
- **method**: متد HTTP درخواست (مانند `GET`, `POST`)  
- **url**: مسیر کامل درخواست (endpoint) مانند `/market/orders/list?fromId=123`
- **body**: محتوای خام بدنه درخواست (برای متدهای `POST`، `PUT` و …)  

> توجه: مقدار `Nobitex-Key` همان کلید عمومی شماست و باید به صورت ثابت در هدر ارسال شود.

```bash
curl -X POST "https://apiv2.nobitex.ir/orders/cancel-old" \
  -H "Content-Type: application/json" \
  -H "Nobitex-Key: <Your-Public-Key>" \
  -H "Nobitex-Signature: <Generated-Signature>" \
  -H "Nobitex-Timestamp: <Unix-Timestamp>" \
  -d '{
        "order": 27032,
        "status": "canceled"
      }'
```


<h2 id="intro-ua">تنظیم User Agent</h2>
جهت شناسایی و تفکیک بهتر بات‌ها و پشتیبانی از آن‌ها، اکیداً توصیه می‌شود که در تمامی درخواست‌ها مقدار هدر User-Agent را مطابق الگوی `TraderBot/XXXXX` ارسال نمایید، که بخش `XXXXX` هر نام یکتایی است که می‌توانید برای بات خود انتخاب کنید. با رعایت این نام‌گذاری پاسخگویی به درخواست‌های پشتیبانی و عیب‌یابی مشکلات بهتر صورت می‌گیرد.


<h2 id="intro-limits">محدودیت‌ها</h2>
توجه داشته باشید، برای استفاده از APIها محدودیت هایی وجود دارد که در قسمت توضیحات هر کدام از APIها این موارد ذکر شده است.

همچنین به منظور حفظ امنیت حساب کاربران، در هنگام احرازهویت(لاگین)، در صورتی که دستگاه شما جدید شناخته شود، محدودیت برداشت به مدت یک‌ساعت روی حساب کاربری شما اعمال خواهد شد. کاربرانی که فرایند دریافت توکن با زمان کمتر از این یک‌ساعت دارند میتوانند مقدار device را که در جواب دریافت توکن دریافت کرده‌اند را در مراحل بعدی به همراه دیگر پارامترها ارسال، تا از اعمال این محدودیت جلوگیری نمایند.

روش دیگری که پیش و روی شماست استفاده از توکن‌های بلندمدت است.

<h2 id="intro-changelog">تغییرات و موارد قدیمی</h2>
با توجه به ماهیت نوین و تغییرات مستمر مورد نیاز در حوزه رمزارزها، در API نوبیتکس نیز ممکن است در طول زمان تغییراتی ایجاد شود. پشتیبانی طولانی‌مدت از نسخه‌های قدیمی API معمولاً فرآیندی پیچیده و سخت است و باعث کاهش سرعت ایجاد تغییرات جدید در بستر نوبیتکس می‌شود. به همین دلیل API نوبیتکس همواره در عین حفظ ساختار کلی و اجزای اصلی ثابت، در حال بهبود مستمر و به‌روزرسانی است. کاربران گرامی می‌توانند با پیگیری تغییرات API که در [صفحه سابقه تغییرات API نوبیتکس](/changelog/) اطلاع‌رسانی می‌شود، همواره از تغییرات احتمالی ضروری در کد خود مطلع شوند تا بتوانند به صورت بدون وقفه از جدیدترین امکانات و روش‌های دسترسی به API نوبیتکس بهره‌مند شوند.

مواردی که قبلاً در API موجود بودند ولی در حال حاضر پشتیبانی نمی‌شوند، جهت ثبت سابقه در [صفحه API قدیمی](/deprecated/) موجود هستند. ممکن است APIهای دیگری علاوه بر موارد مستند شده در مستندات پیش‌رو وجود داشته باشند، که این موارد جز API رسمی نوبیتکس نبوده و تضمینی در قبال ادامه‌دار بودن پشتیبانی از آن‌ها وجود ندارد. همین طور در استفاده از APIهای فعلی لازم به توضیح است که ممکن است علاوه بر فیلدهایی که در ورودی یا خروجی مستند شده است، فیلدهای دیگری نیز وجود داشته باشند. این فیلدها تا زمانی که در مستندات اضافه نشده باشند باید به عنوان امکانات آزمایشی و موقت در نظر گرفته شوند و نباید مورد استفاده عموم کاربران قرار گیرد. تنها کافی است که کدهای توسعه داده شده در صورت مشاهده فیلدی غیر از فیلدهای مورد انتظار خود، دچار خطا نشوند و صرفاً وجود آن فیلد را نادیده بگیرند.

<h2 id="intro-debugging">راهنمای حل مشکلات</h2>

در صورتی که پاسخ مد نظر خود را از API دریافت نمی‌کنید، ابتدا اطمینان حاصل کنید که تمامی موارد ذکر شده در مستندات مربوطه را به درستی رعایت کرده باشید. بهترین روش حل مشکلات برنامه‌نویسی سعی در ریشه‌یابی مشکلات با تغییر متغیرها و بررسی تمام حالت‌ها و استفاده از روش‌های مرسوم عیب‌یابی کد است.

در صورت حل نشدن مشکل، مراجعه به بخش [سوالات متداول](#faq) و [ملاحظات عمومی](#general-considerations) می‌تواند در عیب‌یابی مفید باشد. همین طور اگر مشکل مربوط به حساب شما باشد و اقدامی را نه از طریق API و نه از طریق سایت نوبیتکس نتوانید انجام دهید، باید با
<a href="https://nobitex.ir/contact-us/" target="_blank">پشتیبانی آنلاین نوبیتکس</a>
در ارتباط باشید.

در صورتی که بخشی از مستندات API مبهم است، یا پیشنهادی درباره APIهای موجود دارید، یا پس از بررسی کامل اطمینان دارید که مشکلی در API نوبیتکس وجود دارد، می‌توانید در
<a href="https://github.com/nobitex/docs-api" target="_blank">مخزن گیت‌هاب مستندات نوبیتکس API</a>
مورد (issue) جدیدی را ایجاد نمایید و با ما در ارتباط باشید. دقت کنید که این کانال عمومی است و نباید در آن هیچ گونه اطلاعات حساس یا توکن یا سایر اطلاعات حساب خود را مطرح کنید.


<h1 id="quickstart">راهنمای شروع به کار با API</h1>

اگر برای اولین بار از API نوبیتکس یا سایر بازارهای رمزارز استفاده می‌کنید، برای شروع کار پیشنهاد می‌شود گام‌های زیر را طی کنید:

* برای شروع کار با API پیشنهاد می‌شود که ابتدا در نوبیتکس
<a href="https://nobitex.ir/signup/" target="_blank">ثبت‌نام</a>
نمایید و مراحل احراز هویت خود را حداقل تا سطح یک انجام دهید.
* با مراجعه به پنل کاربری خود در نوبیتکس، از بخش پروفایل وارد
<a href="https://nobitex.ir/app/settings/" target="_blank">صفحه تنظیمات</a>
شده و توکن خود را دریافت نمایید. دسترسی به این توکن به منزله دسترسی کامل به حساب شماست، در نتیجه در حفاظت آن دقت کامل داشته باشید.
* اگر با نرم‌افزار Postman آشنا هستید، می‌توانید برای تست فراخوانی APIهای اصلی نوبیتکس، از
<a target="_blank" rel="nofollow" href="https://documenter.getpostman.com/view/5722122/Szmcayjw?version=latest">کالکشن Postman نوبیتکس</a>
استفاده کنید. لازم به توضیح است که این کالکشن تنها شامل برخی از APIهای نوبیتکس و کاربرد آن‌ها است و مرجع اصلی مستندات، همین صفحه است.

همین طور می‌توانید بنا به نیاز خود این موارد را نیز در ادامه در نظر بگیرید:

* در صورت تمایل به دریافت دوره‌ای و خودکار توکن، می‌توانید از
<a href="#login">API ورود - دریافت توکن</a>
استفاده نمایید.
