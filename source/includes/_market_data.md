# اطلاعات بازار (عمومی)

<h2 id="orderbook-v3">لیست سفارش‌ها: اردربوک</h2>

```shell
curl 'https://api.nobitex.ir/v3/orderbook/BTCIRT'
```

```plaintext
http GET https://api.nobitex.ir/v3/orderbook/BTCIRT
```

> در صورت فراخوانی درست، پاسخ به این صورت خواهد بود:

```json
{
    "status": "ok",
    "lastUpdate": 1644991756704,
    "lastTradePrice": "35650565900",
    "asks": [
        ["1476091000", "1.016"],
        ["1479700000", "0.2561"]
    ],
    "bids": [
        ["1470001120", "0.126571"],
        ["1470000000", "0.818994"]
    ]
}
```

برای دریافت لیست سفارش‌ها یا همان اردربوک بازارهای مختلف، از این درخواست استفاده نمایید:

- **درخواست:** `GET /v3/orderbook/SYMBOL`
- **محدودیت فراخوانی:** 300 درخواست در دقیقه
- **نیاز به ارسال توکن:** ندارد

<aside class="warning">
برای دریافت اردربوک حتماً از متد <code>GET</code> و با ارسال نماد در آدرس url استفاده نمایید. در حال حاضر در این اندپوینت متد <code>POST</code> پشتیبانی نمی‌شود.
</aside>

### پارامترهای ورودی

پارامتر     | نوع    | پیش‌فرض   |  توضیحات   | نمونه
----------- | ----   | ------   | ---------  | -----
SYMBOL | string |   الزامی | نماد بازار | `BTCIRT`

<aside class="notice">
لیست نمادهای معتبر بازارها عبارتند از:<br/> <span class="market-symbols"></span>
</aside>

```shell
curl 'https://api.nobitex.ir/v3/orderbook/all'
```

> نمونه پاسخ درخواست <code dir="ltr">/v3/orderbook/all</code>:

```json
{
  "status": "ok",
  "BTCIRT": {
    "lastUpdate": 1644991756704,
    "asks": [
      ["1476091000", "1.016"],
      ["1479700000", "0.2561"]
    ],`
    "bids": [
      ["1470001120", "0.126571"],
      ["1470000000", "0.818994"]
    ]
  },
  "USDTIRT": {
    "lastUpdate": 1644991767392,
    "asks": [
      ["277990", "6688.3"],
      ["278000", "28185.03"]
    ],
    "bids": [
      ["277960", "119.31"],
      ["271240", "1079.75"]
    ]
  }
}
```

<aside class="notice">
در صورت تمایل به دریافت لیست سفارشات همه بازارها به صورت یکجا از مقدار <code>all</code> برای symbol استفاده نمایید.
</aside>

### پارامترهای پاسخ
خروجی شامل دو آرایه `asks` و `bids` بوده که در هر یک قیمت و مقدار سفارش‌های بازار وجود دارد. سفارش‌های خرید در `bids` و سفارش‌های فروش در `asks` بازگردانده می‌شوند. هر یک از این آرایه‌ها شامل دوتایی‌های «قیمت، مقدار» هستند.

همچنین زمان آخرین به‌روزرسانی در اردربوک ذیل پارامتر `lastUpdate` به فرمت یونیکس داده می‌شود.


| پارامتر پاسخ       | نوع    | توضیحات                                               | نمونه                                                     |
|--------------------|--------|-------------------------------------------------------|-----------------------------------------------------------|
| `asks`             | array  | حاوی دوتایی‌های «قیمت، مقدار» از سفارش‌های **فروش**     | <code dir="ltr">[["1231", "0.1"],["1243", "1.02"]]</code> |
| `bids`             | array  | حاوی دوتایی‌های «قیمت، مقدار» از سفارش‌های **خرید**     | <code dir="ltr">[["1243", "1"],["1231", "2"]]</code>      |
| `lastTradePrice`   | string | مبلغ آخرین معامله                                     | <code dir="ltr">"35602702700"</code>                      |
| `lastUpdate`       | int    | زمان آخرین به‌روزرسانی به فرمت یونیکس                  | <code dir="ltr">1726651067347</code>                      |



### روش پیشنهادی نگهداری اردربوک
به این منظور از وب‌سوکت استفاده نمایید. برای اطلاعات بیشتر به [مستندات وب‌سوکت نوبیتکس](#websocket) مراجعه فرمایید.

در صورتی‌که نمی‌توانید از وب‌سوکت استفاده کنید و در پروژه‌ی خود نیاز به نگهداری آخرین وضعیت اردربوک نوبیتکس هستید، در یک حلقه اقدام به دریافت اردربوک نوبیتکس نمایید. حتماً در میان هر دو بار اجرای حلقه حداقل یک تا ده ثانیه صبر نمایید و از فراخوانی پیاپی و بی‌مکث اردربوک خودداری کنید. به دلیل وجود لایه‌های کش، در صورت فراخوانی در بازه‌های زیر یک ثانیه، همان داده فراخوانی قبلی را دریافت خواهید نمود. اگر در اغلب بازارهای نوبیتکس فعال هستید، می‌توانید در هر فراخوانی کل اردربوک را دریافت نمایید تا نیازی به فراخوانی همزمان چند اردربوک نداشته باشید. اگر کد خود را در چند رشته (ترد) یا پردازه یا سرور اجرا می‌کنید، حتماً اردربوک را در یک مرجع واحد دریافت نمایید و آن را در میان نمونه‌های برنامه خود به اشتراک بگذارید.

<h2 id="orderbook">لیست سفارش‌ها (Deprecated)</h2>


```shell
curl 'https://api.nobitex.ir/v2/orderbook/BTCIRT'
```

```plaintext
http GET https://api.nobitex.ir/v2/orderbook/BTCIRT
```

> در صورت فراخوانی درست، پاسخ به این صورت خواهد بود:

```json
{
    "status": "ok",
    "lastUpdate": 1644991756704,
    "lastTradePrice": "35450560000",
    "bids": [
        ["1476091000", "1.016"],
        ["1479700000", "0.2561"]
    ],
    "asks": [
        ["1470001120", "0.126571"],
        ["1470000000", "0.818994"]
    ]
}
```

- **درخواست:** `GET /v2/orderbook/SYMBOL`
- **محدودیت فراخوانی:** 300 درخواست در دقیقه
- **نیاز به ارسال توکن:** ندارد


این اندپوینت، به جز یک مورد، کاملاً مشابه [API ورژن ۳](#orderbook-v3) می‌باشد با این تفاوت که جای کلید‌های `asks` و `bids` جابه‌جا می‌باشد. بنابراین سفارش‌های **فروش** در **`bids`** و سفارش‌های **خرید** در **`asks`** بازگردانده می‌شوند. از آن‌جایی که این اندپوینت منسوخ و deprecate شده و ممکن است در آینده نگهداری نشود، ترجیح اکید بر این است که از اندپوینت ورژن ۳ استفاده شود.


<aside class="warning">
برای دریافت اردربوک حتماً از متد <code>GET</code> و با ارسال نماد در آدرس url استفاده نمایید. روش قدیمی مبتنی بر <code>POST</code> دیگر پشتیبانی نمی‌شود.
</aside>

## نمودار عمق (آزمایشی)

```shell
curl 'https://api.nobitex.ir/v2/depth/BTCIRT'
```

```plaintext
http GET https://api.nobitex.ir/v2/depth/BTCIRT
```

> در صورت فراخوانی درست، پاسخ به این صورت خواهد بود:

```json
{
  "status": "ok",
  "lastUpdate": "1658565992195",
  "bids": [["7309999000", "2.200274"], ["7310000000", "2.199856"], ["7310025000", "2.102569"]],
  "asks": [["7409894000", "0.054789"], ["7447665000", "0.055276"], ["7450000000", "0.059756"]],
  "lastTradePrice": "7417000000"}
```

برای دریافت داده‌های نمودار عمق، یا همان اردربوک بازارهای مختلف، از این درخواست استفاده نمایید:

- **درخواست:** `GET /v2/depth/SYMBOL`
- **محدودیت فراخوانی:** 300 درخواست در دقیقه
- **نیاز به ارسال توکن:** ندارد

<aside class="warning">
برای دریافت اردربوک حتماً از متد GET و با ارسال نماد در آدرس url استفاده نمایید.
</aside>

### پارامترهای ورودی

پارامتر     | نوع    | پیش‌فرض   |  توضیحات   | نمونه
----------- | ----   | ------   | ---------  | -----
SYMBOL | string |   الزامی | نماد بازار | `BTCIRT`

<aside class="notice">
لیست نمادهای معتبر بازارها عبارتند از:<br/> <span class="market-symbols"></span>
</aside>

### پارامترهای پاسخ
خروجی شامل دو آرایه asks و bids بوده که در هر یک قیمت و مقدار سفارش‌های بازار وجود دارد. **سفارش‌های خرید در `bids` و سفارش‌های فروش در `asks` بازگردانده می‌شوند.** هر یک از این آرایه‌ها شامل دوتایی‌های «قیمت، مقدار» هستند که در هر دوتایی، مقدار قیمت، تجمیع شده و گرد شده با دقت مناسب بازار مورد نظر است.

همچنین زمان آخرین به‌روزرسانی نمودار عمق ذیل پارامتر `lastUpdate` به فرمت یونیکس داده می‌شود.

همچنین، مبلغ آخرین معامله ذیل پارامتر `lastTradePrice` ارسال می‌شود. 

### روش پیشنهادی نگهداری نمودار عمق
در صورتی که در کد خود نیاز به نگهداری آخرین وضعیت نمودار عمق نوبیتکس هستید، در یک حلقه اقدام به دریافت نمودار عمق نوبیتکس نمایید. حتماً در میان هر دو بار اجرای حلقه حداقل یک تا ده ثانیه صبر نمایید و از فراخوانی پیاپی و بی‌مکث خودداری کنید. به دلیل وجود لایه‌های کش، در صورت فراخوانی در بازه‌های زیر یک ثانیه، همان داده فراخوانی قبلی را دریافت خواهید نمود.

## لیست معاملات

```shell
curl 'https://api.nobitex.ir/v2/trades/BCHIRT'
```

```plaintext
http GET https://api.nobitex.ir/v2/trades/BCHIRT
```

> در صورت فراخوانی درست، پاسخ به این صورت خواهد بود:

```json
{
    "status": "ok",
    "trades": [
        {
            "time": 1588689375067,
            "price": "1470000110",
            "volume": "0",
            "type": "sell"
        },
        {
            "time": 1588689360464,
            "price": "1470000110",
            "volume": "0.002",
            "type": "buy"
        }
    ]
}
```

برای دریافت لیست معاملات از این نوع درخواست استفاده نمایید:

- **درخواست:** `GET v2/trades/SYMBOL `
- **محدودیت فراخوانی:** 60 درخواست در دقیقه
- **نیاز به ارسال توکن:** ندارد


### پارامترهای ورودی

پارامتر     | نوع    | پیش‌فرض   |  توضیحات   | نمونه
----------- | ----   | ------   | ---------  | -----
symbol | string |   الزامی | نماد | `BTCIRT`


<aside class="notice">
لیست نمادهای معتبر بازار ها عبارتند از: <br><span class="market-symbols"></span>
</aside>

پارامتر بازگشتی time زمان دقیق انجام شدن معامله است که با فرمت <a href="https://fa.wikipedia.org/wiki/%D8%B3%D8%A7%D8%B9%D8%AA_%DB%8C%D9%88%D9%86%DB%8C%DA%A9%D8%B3" target="_blank">یونیکس</a> نمایش داده میشود

## آمار بازار نوبیتکس

```shell
curl 'https://api.nobitex.ir/market/stats?srcCurrency=btc&dstCurrency=rls'
```

```plaintext
http GET https://api.nobitex.ir/market/stats \
  srcCurrency=btc dstCurrency=rls
```

> در صورت فراخوانی درست، پاسخ به این صورت خواهد بود:

```json
{
  "status": "ok",
  "stats": {
    "btc-rls": {
      "isClosed": false,
      "bestSell": "749976360",
      "bestBuy": "733059600",
      "volumeSrc": "0.2929480000",
      "volumeDst": "212724856.0678640000",
      "latest": "750350000",
      "mark": "747461987",
      "dayLow": "686021860",
      "dayHigh": "750350000",
      "dayOpen": "686021860",
      "dayClose": "750350000",
      "dayChange": "9.38"
    }
  }
}
```

برای دریافت آخرین آمار بازار نوبیتکس از این نوع درخواست استفاده نمایید:

- **درخواست** `GET /market/stats`
- **محدودیت فراخوانی:** 20 درخواست در دقیقه


### پارامترهای ورودی

 پارامتر     | نوع    | پیش‌فرض | توضیحات    | نمونه      
-------------|--------|---------|------------|------------
 srcCurrency | string | اختیاری | ارزها مبدا | `btc,usdt` 
 dstCurrency | string | اختیاری | ارز مقصد   | `rls`      

پارامترهای srcCurrency و dstCurrency اختیاری هستند و اگر این پارامترها را وارد نکنید، آمار مربوط به کل بازار نوبیتکس نمایش داده خواهد شد.

<aside class="notice">
انواع ارز:<br>
<span class="currency-symbols"></span>
</aside>
<aside class="warning">
در شی پاسخ جهت سازگاری با نسخه‌های پیشین، آمار بازار بایننس نیز برگردانده می‌شود.
دقت کنید این قسمت از اطلاعات (متناظر با کلید global) منسوخ شده و در نسخه‌های آتی به طور کامل حذف خواهد شد.
توصیه می‌شود جهت دریافت آمار بازار بایینس از <a href="#cdf265d0e6">آمار بازار جهانی</a> استفاده نمایید.
</aside>

## آمار OHLC بازار نوبیتکس

```shell
curl 'https://api.nobitex.ir/market/udf/history?symbol=BTCIRT&resolution=D&from=1562058167&to=1562230967'
```

```plaintext
http GET https://api.nobitex.ir/market/udf/history?symbol=BTCIRT&resolution=D&from=1562058167&to=1562230967
```

> در صورت فراخوانی درست، پاسخ به این صورت خواهد بود:

```json
{
  "s": "ok",
  "t": [1562095800, 1562182200],
  "o": [146272500, 150551000],
  "h": [155869600, 161869500],
  "l": [140062400, 150551000],
  "c": [151440200, 157000000],
  "v": [18.221362316, 9.8592626506]
}
```

برای توضیحات بیشتر در مورد  OHLC به [این لینک](https://en.wikipedia.org/wiki/Open-high-low-close_chart) مراجعه کنید.<br><br>
برای دریافت  آمار OHLC نوبیتکس از این نوع درخواست استفاده نمایید:

- **درخواست:** `GET /market/udf/history`

### پارامترهای ورودی

| پارامتر    | نوع    | پیش‌فرض | توضیحات                                                            | نمونه        |
|------------|--------|---------|--------------------------------------------------------------------|--------------|
| symbol     | string | الزامی  | نماد بازار                                                         | `BTCIRT`     |
| resolution | string | الزامی  | بازه زمانی هر کندل                                                 | `D`          |
| to         | int    | الزامی  | زمان پایان بازه                                                    | `1562230967` |
| from       | int    | اختیاری  | زمان ابتدای بازه                                                   | `1562058167` |
| countback  | int    | اختیاری | تعداد کندل‌های پیش از زمان پایان<br/>(اولویت آن از from بیشتر است) | `4`          |
| page       | int    | `1`     | شماره صفحه                                                         | `3`          |

> در صورت ورودی اشتباه برای resolution پاسخ به این صورت خواهد بود:

```json
{
  "s": "error",
  "errmsg": "Invalid resolution!"
}
```

* پارامتر resolution  بازه زمانی  کندل‌های خروجی می‌باشد و مقدار آن می‌تواند یکی از مقادیر زیر باشد:

| دقیقه‌ای | توضیح     | ساعتی | توضیح       | روزانه | توضیح  |
|----------|-----------|-------|-------------|--------|--------|
| `1`      | یک دقیقه  | `60`  | یک ساعت     | `D`    | یک روز |
| `5`      | پنج دقیقه | `180` | سه ساعت     | `2D`   | دو روز |
| `15`     | یک ربع    | `240` | چهار ساعت   | `3D`   | سه روز |
| `30`     | نیم ساعت  | `360` | شش ساعت     |        |        |
|          |           | `720` | دوازده ساعت |        |        |

* مقادیر from و to زمان شروع و پایان جست‌وجو را مشخص می‌کند و با فرمت یونیکس به ثانیه مشخص می‌شود.

> در صورت نبودن داده در بازه درخواستی پاسخ به این صورت خواهد بود:

```json
{
  "s": "no_data"
}
```

<aside class="notice">
کندل‌های دقیقه‌ای بازارها از آغاز سال 1401 در دسترسند و دسترسی به کندل‌های دقیقه‌ای پیش از آن موجود نیست.
</aside>

<aside class="notice">
لیست نمادهای معتبر بازارها عبارتند از:<br/> <span class="market-symbols"></span>
</aside>

### پارامترهای پاسخ

در هر درخواست بسته به پارامتر countback یا بازه زمانی تعیین شده و resolution انتخابی، تعداد کندل‌های برگشتی متفاوت است.
برای مثال تعداد کندل‌های 1 ساعته از تاریخ 2019/2/9 15:39:41 تا چهار ساعت قبل آن، ۴ تاست.

| پارامتر | توضیح        | نوع       | نمونه            |
|---------|--------------|-----------|------------------|
| `s`     | وضعیت پاسخ   | string    | `ok`             |
| `t`     | شروع زمان    | [ ] int   | `[1562182200]`   |
| `o`     | قیمت شروع    | [ ] float | `[150551000]`    |
| `h`     | بیشترین قیمت | [ ] float | `[161869500]`    |
| `l`     | کمترین قیمت  | [ ] float | `[150551000]`    |
| `c`     | قیمت پایانی  | [ ] float | `[157000000]`    |
| `v`     | حجم معاملات  | [ ] float | `[9.8592626506]` |

* در هر درخواست حداکثر 500 کندل بازگردانده می‌شود. برای بازیابی همه کندل‌های یک بازه با بیش از 500 کندل، از پارامتر page برای صفحه‌بندی استفاده نمایید.


## آمار بازار جهانی

```shell
curl 'https://api.nobitex.ir/market/global-stats' \
  -X POST

```

```plaintext
http POST https://api.nobitex.ir/market/global-stats
```

> در صورت فراخوانی درست، پاسخ به این صورت خواهد بود:

```json
{
    "ltc": {
        "kraken": {
            "price": "41.69"
        }
    },
    "btc": {
        "kraken": {
            "price": "5517.2"
        }
    },
    ...

    "status": "ok"
}
```

برای دریافت آمار بازارهای جهانی از این نوع درخواست استفاده نمایید:

- **درخواست:** `POST /market/global-stats`
- **محدودیت فراخوانی:** ۱۰۰ درخواست در ۱۰ دقیقه

<aside class="notice">
این آمارها مربوط به بازارهای Kraken و Binance می باشد
</aside>
